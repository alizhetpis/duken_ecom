{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alizhetpis/Documents/duken/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/alizhetpis/Documents/duken/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/alizhetpis/Documents/duken/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import Axios from'axios';import{Link,useLocation,useNavigate}from'react-router-dom';import Container from'react-bootstrap/Container';import Form from'react-bootstrap/Form';import Button from'react-bootstrap/Button';import Modal from'react-bootstrap/Modal';import{Helmet}from'react-helmet-async';import{useContext,useState}from'react';import{Store}from'../Store';import{toast}from'react-toastify';import{getError}from'../utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function SigninScreen(){var navigate=useNavigate();var _useLocation=useLocation(),search=_useLocation.search;var redirectInUrl=new URLSearchParams(search).get('redirect');var redirect=redirectInUrl?redirectInUrl:'/';var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),twoFactorToken=_useState6[0],setTwoFactorToken=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),show2FAModal=_useState8[0],setShow2FAModal=_useState8[1];var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var userInfo=state.userInfo;var finalizeLogin=function finalizeLogin(data){ctxDispatch({type:'USER_SIGNIN',payload:data});localStorage.setItem('userInfo',JSON.stringify(data));navigate(redirect||'/');};var submitHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$Axios$post,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return Axios.post('/api/users/signin',{email:email,password:password});case 4:_yield$Axios$post=_context.sent;data=_yield$Axios$post.data;console.log(\"Server Response:\",data);if(data.require2FA){console.log(\"2FA is required. Showing modal...\");setShow2FAModal(true);// Показать модальное окно 2FA\n}else{console.log(\"2FA is not required. Finalizing login...\");finalizeLogin(data);// Завершение процесса входа и перенаправление\n}_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.log(\"Error during sign in:\",_context.t0);toast.error(getError(_context.t0));case 14:case\"end\":return _context.stop();}},_callee,null,[[1,10]]);}));return function submitHandler(_x){return _ref.apply(this,arguments);};}();var handle2FASubmission=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _yield$Axios$post2,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return Axios.post('/api/users/verify-2fa',{email:email,twoFactorToken:twoFactorToken});case 3:_yield$Axios$post2=_context2.sent;data=_yield$Axios$post2.data;finalizeLogin(data);// Завершение процесса входа после успешной проверки 2FA\nsetShow2FAModal(false);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);toast.error(\"Invalid 2FA code\");case 12:case\"end\":return _context2.stop();}},_callee2,null,[[0,9]]);}));return function handle2FASubmission(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Container,{className:\"small-container\",children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Sign In\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"my-3\",children:\"Sign In\"}),/*#__PURE__*/_jsxs(Form,{onSubmit:submitHandler,children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"email\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",required:true,onChange:function onChange(e){return setEmail(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"password\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Password\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"password\",required:true,onChange:function onChange(e){return setPassword(e.target.value);}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"Sign In\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[\"New customer?\",' ',/*#__PURE__*/_jsx(Link,{to:\"/signup?redirect=\".concat(redirect),children:\"Create your account\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[\"Forget Password? \",/*#__PURE__*/_jsx(Link,{to:\"/forget-password\",children:\"Reset Password\"})]})]}),/*#__PURE__*/_jsxs(Modal,{show:show2FAModal,onHide:function onHide(){return setShow2FAModal(false);},children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Two-factor authentication code\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"twoFactorToken\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Enter code\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",required:true,onChange:function onChange(e){return setTwoFactorToken(e.target.value);}})]})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:function onClick(){return setShow2FAModal(false);},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var _yield$Axios$post3,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return Axios.post('/api/users/signin',{email:email,password:password,twoFactorToken:twoFactorToken});case 3:_yield$Axios$post3=_context3.sent;data=_yield$Axios$post3.data;finalizeLogin(data);setShow2FAModal(false);_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);toast.error(getError(_context3.t0));case 12:case\"end\":return _context3.stop();}},_callee3,null,[[0,9]]);})),children:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"})]})]})]});}","map":{"version":3,"names":["Axios","Link","useLocation","useNavigate","Container","Form","Button","Modal","Helmet","useContext","useState","Store","toast","getError","SigninScreen","navigate","search","redirectInUrl","URLSearchParams","get","redirect","email","setEmail","password","setPassword","twoFactorToken","setTwoFactorToken","show2FAModal","setShow2FAModal","state","ctxDispatch","dispatch","userInfo","finalizeLogin","data","type","payload","localStorage","setItem","JSON","stringify","submitHandler","e","preventDefault","post","console","log","require2FA","error","handle2FASubmission","target","value"],"sources":["/Users/alizhetpis/Documents/duken/frontend/src/screens/SigninScreen.js"],"sourcesContent":["import Axios from 'axios';\nimport { Link, useLocation, useNavigate } from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport { Helmet } from 'react-helmet-async';\nimport { useContext, useState } from 'react';\nimport { Store } from '../Store';\nimport { toast } from 'react-toastify';\nimport { getError } from '../utils';\n\nexport default function SigninScreen() {\n  const navigate = useNavigate();\n  const { search } = useLocation();\n  const redirectInUrl = new URLSearchParams(search).get('redirect');\n  const redirect = redirectInUrl ? redirectInUrl : '/';\n\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [twoFactorToken, setTwoFactorToken] = useState('');\n  const [show2FAModal, setShow2FAModal] = useState(false);\n\n  const { state, dispatch: ctxDispatch } = useContext(Store);\n  const { userInfo } = state;\n\n  const finalizeLogin = (data) => {\n    ctxDispatch({ type: 'USER_SIGNIN', payload: data });\n    localStorage.setItem('userInfo', JSON.stringify(data));\n    navigate(redirect || '/');\n  };\n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n    try {\n      const { data } = await Axios.post('/api/users/signin', { email, password });\n      console.log(\"Server Response:\", data);\n  \n      if (data.require2FA) {\n        console.log(\"2FA is required. Showing modal...\");\n        setShow2FAModal(true);  // Показать модальное окно 2FA\n      } else {\n        console.log(\"2FA is not required. Finalizing login...\");\n        finalizeLogin(data);  // Завершение процесса входа и перенаправление\n      }\n    } catch (err) {\n      console.log(\"Error during sign in:\", err);\n      toast.error(getError(err));\n    }\n  };\n  \n  \n  const handle2FASubmission = async () => {\n    try {\n      const { data } = await Axios.post('/api/users/verify-2fa', {\n        email,\n        twoFactorToken\n      });\n      finalizeLogin(data);  // Завершение процесса входа после успешной проверки 2FA\n      setShow2FAModal(false);\n    } catch (err) {\n      toast.error(\"Invalid 2FA code\");\n    }\n  };\n  \n  return (\n    <Container className=\"small-container\">\n      <Helmet>\n        <title>Sign In</title>\n      </Helmet>\n      <h1 className=\"my-3\">Sign In</h1>\n      <Form onSubmit={submitHandler}>\n        <Form.Group className=\"mb-3\" controlId=\"email\">\n          <Form.Label>Email</Form.Label>\n          <Form.Control\n            type=\"email\"\n            required\n            onChange={(e) => setEmail(e.target.value)}\n          />\n        </Form.Group>\n        <Form.Group className=\"mb-3\" controlId=\"password\">\n          <Form.Label>Password</Form.Label>\n          <Form.Control\n            type=\"password\"\n            required\n            onChange={(e) => setPassword(e.target.value)}\n          />\n        </Form.Group>\n        <div className=\"mb-3\">\n          <Button type=\"submit\">Sign In</Button>\n        </div>\n        <div className=\"mb-3\">\n          New customer?{' '}\n          <Link to={`/signup?redirect=${redirect}`}>Create your account</Link>\n        </div>\n        <div className=\"mb-3\">\n          Forget Password? <Link to={`/forget-password`}>Reset Password</Link>\n        </div>\n      </Form>\n\n      <Modal show={show2FAModal} onHide={() => setShow2FAModal(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>Two-factor authentication code</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Form.Group className=\"mb-3\" controlId=\"twoFactorToken\">\n            <Form.Label>Enter code</Form.Label>\n            <Form.Control\n              type=\"text\"\n              required\n              onChange={(e) => setTwoFactorToken(e.target.value)}\n            />\n          </Form.Group>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={() => setShow2FAModal(false)}>\n            Закрыть\n          </Button>\n          <Button variant=\"primary\" onClick={async () => {\n            try {\n              const { data } = await Axios.post('/api/users/signin', {\n                email,\n                password,\n                twoFactorToken\n              });\n              finalizeLogin(data);\n              setShow2FAModal(false);\n            } catch (err) {\n              toast.error(getError(err));\n            }\n          }}>\n            Войти\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </Container>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}